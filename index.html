<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GPT Vision OCR - Handwriting Extraction</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #a0aec0;
            margin-bottom: 20px;
        }
        
        .api-key-section {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .api-key-input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #4facfe;
            background: rgba(15, 23, 42, 0.6);
            color: white;
            margin-top: 10px;
            font-size: 1rem;
        }
        
        .api-key-input:focus {
            outline: none;
            border-color: #00f2fe;
            box-shadow: 0 0 0 2px rgba(0, 242, 254, 0.3);
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .upload-section, .result-section {
            flex: 1;
            min-width: 300px;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #4facfe;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-area {
            border: 2px dashed #4facfe;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .upload-area:hover {
            background: rgba(79, 172, 254, 0.1);
        }
        
        .upload-area i {
            font-size: 3rem;
            color: #4facfe;
            margin-bottom: 15px;
        }
        
        .upload-area p {
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 242, 254, 0.4);
        }
        
        .btn:disabled {
            background: #4a5568;
            cursor: not-allowed;
        }
        
        .btn-export {
            background: linear-gradient(90deg, #ff6b6b, #ff9e7d);
        }
        
        .btn-export:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        
        #image-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 20px;
            border-radius: 10px;
            display: none;
        }
        
        #extracted-text {
            background: #1e293b;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 20px;
            white-space: pre-wrap;
        }
        
        .progress-container {
            height: 10px;
            background: #2d3748;
            border-radius: 5px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            width: 0%;
            transition: width 0.3s;
        }
        
        .status {
            text-align: center;
            margin: 10px 0;
            color: #a0aec0;
            font-style: italic;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: #a0aec0;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>GPT Vision OCR</h1>
            <p class="subtitle">Extract text from handwritten documents using OpenAI GPT-4o API</p>
        </header>
        
        <div class="api-key-section">
            <h2 class="section-title">
                <i class="fas fa-key"></i> OpenAI API Key
            </h2>
            <p>Enter your OpenAI API key to use the GPT-4o API for text extraction:</p>
            <input type="password" class="api-key-input" id="api-key" placeholder="sk-...">
            <p style="margin-top: 10px; font-size: 0.9rem; color: #a0aec0;">
                Your API key is stored only in your browser and is never sent to our servers.
            </p>
        </div>
        
        <div class="main-content">
            <div class="upload-section">
                <h2 class="section-title">
                    <i class="fas fa-upload"></i> Upload Image
                </h2>
                
                <div class="upload-area" id="drop-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag & drop your image here or click to browse</p>
                    <input type="file" id="file-input" accept="image/*" hidden>
                    <button class="btn" id="browse-btn">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>
                </div>
                
                <div id="image-preview-container">
                    <img id="image-preview" alt="Image Preview">
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progress-bar"></div>
                </div>
                
                <p class="status" id="status">Ready to process your image...</p>
                
                <div class="action-buttons">
                    <button class="btn" id="extract-btn" disabled>
                        <i class="fas fa-qrcode"></i> Extract Text
                    </button>
                    <button class="btn" id="reset-btn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
            </div>
            
            <div class="result-section">
                <h2 class="section-title">
                    <i class="fas fa-file-alt"></i> Extracted Text
                </h2>
                
                <div id="extracted-text">Extracted text will appear here...</div>
                
                <div class="action-buttons">
                    <button class="btn btn-export" id="export-btn" disabled>
                        <i class="fas fa-file-pdf"></i> Export to PDF
                    </button>
                    <button class="btn" id="copy-btn" disabled>
                        <i class="fas fa-copy"></i> Copy Text
                    </button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>GPT Vision OCR Tool - Uses OpenAI GPT-4o API for accurate text extraction</p>
            <p>Note: You need a valid OpenAI API key with access to the GPT-4o API</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Elements
            const dropArea = document.getElementById('drop-area');
            const fileInput = document.getElementById('file-input');
            const browseBtn = document.getElementById('browse-btn');
            const apiKeyInput = document.getElementById('api-key');
            const imagePreview = document.getElementById('image-preview');
            const extractBtn = document.getElementById('extract-btn');
            const resetBtn = document.getElementById('reset-btn');
            const exportBtn = document.getElementById('export-btn');
            const copyBtn = document.getElementById('copy-btn');
            const extractedText = document.getElementById('extracted-text');
            const progressBar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status');
            
            // Event Listeners
            browseBtn.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', handleFileSelect);
            dropArea.addEventListener('dragover', handleDragOver);
            dropArea.addEventListener('drop', handleDrop);
            extractBtn.addEventListener('click', extractText);
            resetBtn.addEventListener('click', resetAll);
            exportBtn.addEventListener('click', exportToPDF);
            copyBtn.addEventListener('click', copyText);
            apiKeyInput.addEventListener('input', validateForm);
            
            // Validate form
            function validateForm() {
                const apiKey = apiKeyInput.value.trim();
                const hasImage = imagePreview.style.display === 'block';
                
                extractBtn.disabled = !(apiKey.length > 0 && hasImage);
            }
            
            // Handle file selection
            function handleFileSelect(e) {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    processImage(file);
                }
            }
            
            // Handle drag over
            function handleDragOver(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.style.background = 'rgba(79, 172, 254, 0.2)';
            }
            
            // Handle drop
            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.style.background = '';
                
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    processImage(file);
                }
            }
            
            // Process the image
            function processImage(file) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    validateForm();
                    statusText.textContent = 'Image loaded. Click "Extract Text" to begin OCR.';
                };
                
                reader.readAsDataURL(file);
            }
            
            // Extract text using OpenAI API
            async function extractText() {
                if (!imagePreview.src) return;
                
                const apiKey = apiKeyInput.value.trim();
                if (!apiKey) {
                    statusText.textContent = 'Please enter a valid OpenAI API key';
                    return;
                }
                
                extractBtn.disabled = true;
                statusText.textContent = 'Processing with GPT-4o...';
                progressBar.style.width = '30%';
                
                try {
                    // Convert image to base64
                    const base64Data = imagePreview.src.split(',')[1];
                    
                    progressBar.style.width = '60%';
                    
                    // Call the OpenAI API
                    const response = await callOpenAIVisionAPI(apiKey, base64Data);
                    
                    progressBar.style.width = '100%';
                    
                    if (response && response.choices && response.choices.length > 0) {
                        const text = response.choices[0].message.content;
                        extractedText.textContent = text;
                        
                        statusText.textContent = 'Text extraction completed!';
                        exportBtn.disabled = false;
                        copyBtn.disabled = false;
                    } else {
                        throw new Error('No text extracted from the image');
                    }
                } catch (err) {
                    statusText.textContent = 'Error: ' + err.message;
                    extractedText.textContent = 'Error: ' + err.message + '\n\nPlease check your API key and try again.';
                    extractBtn.disabled = false;
                }
            }
            
            // Call OpenAI Vision API with GPT-4o
            async function callOpenAIVisionAPI(apiKey, base64Image) {
                const url = 'https://api.openai.com/v1/chat/completions';
                
                const headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                };
                
                const payload = {
                    model: "gpt-4o",
                    messages: [
                        {
                            role: "user",
                            content: [
                                {
                                    type: "text",
                                    text: "Extract all text from this image exactly as it appears. Include all spelling, punctuation, and formatting. If the text is handwritten, do your best to transcribe it accurately. Return only the extracted text without any additional commentary."
                                },
                                {
                                    type: "image_url",
                                    image_url: {
                                        url: `data:image/jpeg;base64,${base64Image}`
                                    }
                                }
                            ]
                        }
                    ],
                    max_tokens: 1000
                };
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || 'API request failed');
                }
                
                return await response.json();
            }
            
            // Export to PDF
            function exportToPDF() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add title
                doc.setFontSize(20);
                doc.setTextColor(40, 120, 200);
                doc.text('Extracted Text from GPT Vision OCR', 105, 15, { align: 'center' });
                
                // Add extracted text
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                
                const text = extractedText.textContent;
                const lines = doc.splitTextToSize(text, 180);
                
                doc.text(lines, 15, 30);
                
                // Add footer
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text('Generated by GPT Vision OCR - ' + new Date().toLocaleDateString(), 105, 280, { align: 'center' });
                
                // Save the PDF
                doc.save('extracted-text.pdf');
            }
            
            // Copy text to clipboard
            function copyText() {
                const text = extractedText.textContent;
                navigator.clipboard.writeText(text).then(() => {
                    statusText.textContent = 'Text copied to clipboard!';
                    setTimeout(() => {
                        statusText.textContent = 'Text extraction completed!';
                    }, 2000);
                }).catch(err => {
                    statusText.textContent = 'Failed to copy text: ' + err;
                });
            }
            
            // Reset all
            function resetAll() {
                fileInput.value = '';
                imagePreview.style.display = 'none';
                imagePreview.src = '';
                extractedText.textContent = 'Extracted text will appear here...';
                progressBar.style.width = '0%';
                statusText.textContent = 'Ready to process your image...';
                extractBtn.disabled = true;
                exportBtn.disabled = true;
                copyBtn.disabled = true;
            }
        });
    </script>
    
    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</body>
</html>
